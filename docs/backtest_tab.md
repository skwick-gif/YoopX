<div dir="rtl" align="right">

## לשונית Backtest – בדיקות היסטוריות (Backtesting)

### 1. מטרה
הפקת סימולציה היסטורית לרווח/סיכון של האסטרטגיה במצב הנתון (פרמטרים, פילטרים, מודל ML פעיל אם בשימוש), כדי לאמת היגיון לפני הפעלה חיה ולהשוות וריאציות שונות (נשמר ב-Run Repo / לוגים).

### 2. אינטגרציה עם לשוניות אחרות (כולל אוטומציה ו-Active Model)
| לשונית | כיצד משפיעה / מושפעת |
|--------|-----------------------|
| Model Dashboard | המודל הפעיל + thresholds.json נטענים אוטומטית (אין צורך פעולה ידנית) ומשפיעים על סינון עסקאות אם Score משתמש ב-ML. |
| Scan | מגדיר Universe ו-Score חישובי; Backtest ישתמש באותה לוגיקה פנימית לכניסה/יציאה. |
| Optimize | לאחר שמוצאים פרמטרים משופרים – רצים כאן Backtest לאימות גלובלי לפני שמירת ריצה. |
| Walkforward | Walkforward בודק יציבות על חלונות; Backtest נותן תמונת “כל ההיסטוריה” אחת. |
| Run Repo | שומר תוצאות Backtest להשוואה (גרסאות פרמטרים שונות). |
| IBKR | החלטות חיות מתבססות על לוגיקה שנבחנה קודם ב-Backtest (כפוף להבדלי חיכוך / latency). |

### 3. רכיבי UI (דוגמה כללית – להתאים למימוש אצלך)
1. Date Range / Bars Lookback – טווח היסטוריה. אם ריק: ייתכן שימוש בברירת מחדל (N ימים).  
2. Capital / Start Equity – הון התחלתי לחישוב PnL מצטבר.  
3. Commission / Slippage – פרמטרי עלויות: אחוז/לבר / tick; מורידים תשואה נטו.  
4. Position Sizing (Fixed / % of Equity / ATR Multiplier) – קובע גודל פוזיציה.  
5. Filters (Min Score, Min ML Prob, Volume, Spread) – סינון עסקאות פוטנציאליות.  
6. Run Backtest / Cancel – שליחת משימה ל-Worker; ביטול אם ארוך.  
7. Progress / Status – חיווי נוכחי.  
8. Results Table – סיכום מדדים (Sharpe, CAGR, MaxDD, WinRate, Trades, Exposure%).  
9. Equity Curve / Chart (אם קיים) – ויזואליזציה של equity לאורך זמן.  
10. Export / Save Run – שמירת ריצה ל-Run Repo.  
11. Help – מדריך זה.  

### 4. תהליך חישובי (High Level)
1. טעינת נתונים היסטוריים (OHLCV) + פיצ'רים + אולי הסתברויות ML (אם Active snapshot).  
2. לוגיקת סיגנל: תנאים / ספים → כניסה ללונג/שורט.  
3. Position sizing → חישוב יחידות / דולרים.  
4. ביצוע עסקאות וירטואלי: מחיר כניסה/יציאה; Commission / Slippage מוחלים.  
5. עדכון Equity + Trade Log.  
6. בתום טווח: חישוב מדדים מצטברים + דרוג.  

### 5. מדדים עיקריים
| מדד | הסבר | כיצד לפרש |
|-----|------|-----------|
| Sharpe | (Return - RF) / Std(Return). בד"כ יומי או בר-באר. | > 1 בינוני, > 1.5 טוב, > 2 חזק; תלוי בתדר. |
| CAGR% | שיעור צמיחה שנתי משוקלל ([(Final/Initial)^(1/Years)]-1). | עקבי עם Sharpe טוב = אסטרטגיה איכותית. |
| MaxDD% | משיכה מקסימלית מהשיא לאזור השפל (Equity Peak→Trough). | DD עמוק מאוד יחסית ל-CAGR מצביע על סיכון פסיכולוגי גבוה. |
| WinRate% | אחוז עסקאות רווחיות. | WinRate נמוך עם Sharpe גבוה = R:R חזק; WinRate גבוה אבל Sharpe נמוך = הפסדים בודדים גדולים. |
| Avg Trade Return | ממוצע תשואת עסקה (אחוז / פיפס). | שלילי → אסטרטגיה לא ברת קיימא; חיובי אך קטן → תלות בנפח עסקאות. |
| Exposure% | אחוז זמן בו ההון בשוק. | נמוך מאוד עם תשואה גבוהה = יעילות הון. |
| Trades | ספירת עסקאות. | מעט מדי (< 30) → המסקנות סטטיסטית חלשות. |
| Profit Factor | סה"כ רווחים / סה"כ הפסדים. | > 1.3 טוב, > 1.6 חזק (תלוי מדגם). |
| Alpha / Beta | רגרסיה מול Benchmark (אם קיים). | Alpha חיובי עקבי רצוי; Beta > 1 = רגישות יתר לשוק. |
| Volatility% | סטיית תקן תשואות שנתית. | להשוות ל-CAGR → יחס סיכון/תשואה. |

### 6. זרימת עבודה מומלצת
1. ודא מודל פעיל (אם משתמשים ב-ML).  
2. קבע טווח נתונים משמעותי (שנים / מחזורים שונים).  
3. התחל בפרמטרים שמרניים (עמלות ו-Slippage ריאליים).  
4. הרץ Backtest → רשום מדדים.  
5. שנה פרמטר אחד (למשל Min Score) → הרץ שוב. הימנע משינוי רב משתנים בכל צעד.  
6. לאחר מציאת סט פרמטרים משופר → אמת ב-Walkforward.  
7. שמור ריצה (Run Repo) להשוואה עתידית.  
8. בדוק רגישות: העלה פי 1.5 את העמלה / Slippage – האם המדדים קורסים? אם כן → אולי Overfit לחיכוך נמוך.  

### 7. דגלי אזהרה (Red Flags)
| סימן | פרשנות | פעולה |
|------|---------|-------|
| Sharpe גבוה מאוד (> 4) במדגם קטן | Overfitting או Bug בחישוב | אשר ידנית לוגיקת רווח / בדוק לוגים |
| MaxDD כמעט אפס | אולי אין עסקאות / או חישוב לא נכון | בדוק Trade Log |
| WinRate > 80% אבל Profit Factor נמוך | הפסדים בודדים מוחקים רווחים | בחן Stops / גודל פוזיציה |
| חשיפה 100% קבועה | למעשה Buy & Hold בתחפושת | הוסף לוגיקת יציאה / פילטרים |
| רגישות קיצונית לשינוי קטן בעמלה | אסטרטגיה תלויה בארביטראז' עדין | שקול ביטול או שינוי מודל |

### 8. Troubleshooting – תקלות נפוצות
| בעיה | סיבה | פתרון |
|------|------|--------|
| אין תוצאות / טבלה ריקה | טעינת נתונים נכשלה | בדוק לוגים / נתיבים / הרשאות |
| Zero Trades | פילטרים הדוקים מדי | הרפה Min Score / הרחב Universe |
| חריגות זמנים ארוכות | Loop לא ווקטוריזי / נתונים גדולים | שקול אופטימיזציה / פרה-חישוב פיצ'רים |
| תאריך התחלה = סוף | טווח לא הוזן נכון | אמת פרמטרים UI |
| הערכים שונים מהרצה קודמת זהה | מודל ML השתנה / Random Seed | קבע Seed / בדוק Snapshot Active |

### 9. בסט-פרקטיס
1. שמור CSV של Trade Log לניתוח חיצוני (Distribution, Holding Time).  
2. תעגן Random Seeds (נדרש אם Backtest כולל חלק אקראי).  
3. אל תכוון למקסימום יחסי (Sharpe מקסימלי) בלי לבדוק יציבות בריצות משנה.  
4. השווה מול Benchmark (SPY / QQQ) ליצירת ערך אמיתי.  
5. פרש פערים גדולים בין Backtest ל-Walkforward כחשד לשבריריות.  

### 10. Mini Glossary (אנגלית → הסבר עברית)
| Term | הסבר |
|------|------|
| Backtest | סימולציה בדיעבד על נתונים היסטוריים. |
| Slippage | החלקה במחיר בין בקשה לביצוע בפועל. |
| Commission | עמלת ברוקר לעסקה. |
| Position Sizing | שיטת קביעת גודל פוזיציה. |
| Equity Curve | עקומת הון מצטבר לאורך זמן. |
| Drawdown | ירידה משיא הון עד תחתית זמנית. |
| Benchmark | מדד ייחוס להשוואה (למשל SPY). |
| Alpha | עודף תשואה מעל ה-Benchmark לאחר התאמות. |
| Beta | רגישות (שיפוע) מול תנודות benchmark. |
| Exposure | זמן ממוצע שבו הון מוקצה לפוזיציות. |

### 11. עדכון אוטומציה / מודל פעיל
1. אין יותר Popup לאחר אימון – מצב חדש מוזרם מיד ל-Active snapshot.
2. Adaptive Threshold יכול לשנות מעט את הסף בזמן אמת; Backtest משתמש ב-threshold הנוכחי בזמן ההרצה (מומלץ לציין בלוג אם threshold זז).
3. אם drift גרם לאימון מחדש אוטומטי – תוצאות Backtest ישתנו בריצות מאוחרות; שמור רפרנס timestamp.

### 12. סיכום קצר
Backtest מספק “תמונת מצב היסטורית” אחת. הוא הכרחי אך לא מספיק: משלבים Walkforward (יציבות), Drift (שינוי התפלגות), Optimize (פרמטרים), ו-Active Metrics Panel כדי לקבל החלטות.

----
שדרוגים עתידיים מוצעים: גרף Distribution להחזקת זמן, Monte-Carlo Resampling, ניתוח תרחישי Stress.

</div>
