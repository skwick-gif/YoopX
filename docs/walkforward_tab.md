<div dir="rtl" align="right">

## לשונית Walkforward – הערכת יציבות אסטרטגית (מעודכן)

### 1. מטרה
Walk-Forward (או Rolling / Expanding Window Evaluation) בודק האם ביצועי האסטרטגיה/מודל עקביים כאשר מאמנים על פרק זמן אחד ובוחנים על פרק עוקב. זה מפחית Overfitting ומזהה תקופות שוק בעייתיות.

### 2. כיצד זה משתלב עם שאר הלשוניות
| לשונית | תרומה לזרימה |
|--------|--------------|
| Model Dashboard | המודל הפעיל ו-thresholds.json נטענים אוטומטית (אין צורך לפעול); Drift גבוה שנמדד מקביל יכול לרמוז על צורך במודל חדש. |
| Scan | תוצאות הסריקה משתמשות במודל פעיל; Walkforward יכול להתריע שהמודל לא יציב לפני שמסתמכים עליו. |
| Optimize | אחרי שהתקבלו פרמטרים מועדפים – רצוי להריץ Walkforward כדי לוודא שהם לא מותאמים יתר על ההיסטוריה. |
| Backtest | Backtest נותן תמונה “כוללת” אחת; Walkforward מפרק אותה לחלונות ומראה שונות ביצועים. |
| Run Repo | שמירת ריצות מאפשרת להשוות בין ניסויי Walkforward שונים (שינוי folds / oos_frac / מודל פעיל). |

### 3. רכיבי UI
1. Folds – מספר חלוקות (K). לדוגמה 4: מאמנים על חלון 1 → בודקים על 2; מאמנים על (1+2) → בודקים על 3; וכו'.
2. OOS Fraction – יחס החלק שיוגדר כ-Out-Of-Sample בכל צעד (למשל 0.2 = 20%).
3. Min Trades – סף סינון: כשהתוצאה בחלון מכילה פחות עסקאות – אפשר לסנן/לסמן.
4. Run / Cancel – הפעלת תהליך Worker; ניתן לעצור אם ארוך.
5. Progress Bar – חיווי התקדמות.
6. טבלת תוצאות – לכל שורה: Symbol, Strategy, Fold, Train Start/End, Test Start/End, Sharpe, CAGR%, MaxDD%, WinRate%, Trades.
7. Download CSV – ייצוא כל התוצאות לחקירה חיצונית.
8. Help – מדריך זה.

### 4. לוגיקה בסיסית (היוריסטית)
הפיצול מתבצע סדרתית: בכל Fold הנתונים שנבחרו ל-Train אינם חופפים לאזור ה-Test (OOS). ניתן ליישם Rolling (חלון נע) או Expanding (מצטבר). המערכת הנוכחית (לפי קוד) נראית קרובה ל-Expanding – בדוק ב-Backend אם יש צורך ברולינג קשיח.

### 5. מדדים עיקריים
| מדד | משמעות | ניתוח |
|-----|---------|-------|
| Sharpe | יחס תשואה לעומת סטיית תקן | שונות גבוהה בין Folds = חוסר יציבות |
| CAGR% | שיעור צמיחה שנתי משוקלל | עקביות לאורך Folds חיונית |
| MaxDD% | משיכה מקסימלית | עלייה ב-DD בחלונות מאוחרים → שחיקה |
| WinRate% | אחוז עסקאות חיוביות | לבדוק צניחות פתאומיות |
| Trades | ספירת עסקאות | נמוך מאוד יכול להטעות במדדים אחרים |

### 6. זרימת עבודה מומלצת
1. ודא שיש מספיק נתונים היסטוריים (Data Loader / Fetchers מעודכנים).
2. בחר מספר Folds (התחל 4–6; אם נתונים ארוכים מאוד אפשר יותר).
3. קבע OOS Fraction (0.2 נפוץ; אם תנודתיות גבוהה – שקול 0.25–0.3).
4. הגדר Min Trades (אם אסטרטגיה דלה בעסקאות – השאר 0).
5. הרץ Walkforward → בדוק פיזור המדדים בטבלה.
6. זיהית Fold חלש? רשום את טווח התאריכים (Test Start/End) → חקור ב-Backtest ממוקד או ניתוח ויזואלי חיצוני.
7. אם Folds הראשונים טובים ואחרונים גרועים: ייתכן שינוי Regime – בדוק Drift בלשונית Model Dashboard.
8. בצע התאמות (Optimize / Train מחדש) וחזור על הריצה – השווה בריצות שמורות (Run Repo).

### 7. ניתוח איכות – מה לחפש
1. סטיית תקן Sharpe נמוכה יחסית → יציבות.
2. CAGR% לא צריך לעלות/לרדת חד – מגמות חדות מעידות על התאמה לאזור מסוים בלבד.
3. MaxDD% חריג ב-Fold בודד → בדוק אם אירוע חד פגע במודל (Earnings Crash / Macro News).
4. Trades מעט מדי (לדוגמה < 5) → המדדים לא מייצגים; שקול הרחבת ביקורת (עוד סימבולים / פרמטרים).
5. Correlation בין Sharpe ל-WinRate: אם WinRate סביר אבל Sharpe נופל – אולי R:R התדרדר (תן דגש באופטימיזציה אחרת).

### 8. פרשנות כשל
| תרחיש | סיבה אפשרית | מה לעשות |
|-------|--------------|----------|
| כל ה-Folds טובים חוץ מאחרון | שינוי תנאי שוק | בדוק Drift / עדכן מודל / צמצם חשיפה |
| Sharpe חיובי אך CAGR נמוך | אסטרטגיה עם מינוף/נפח נמוך | בדוק Allocation / גודל פוזיציה |
| WinRate גבוה, Sharpe נמוך | הפסדים בודדים גדולים | בדוק Stop / ATR / Position Sizing |
| MaxDD גדול בחלונות מוקדמים | בעיה בנתונים היסטוריים / מבני | נקה Outliers / בדוק איכות נתונים |
| מספר Trades יורד בכל Fold | סינון יתר בפרמטרים | הרפיית פילטרים / הרחבת Universe |

### 9. אינטגרציה עם תהליך האימון
ריצת Walkforward לפני אימון נוסף עוזרת לזהות האם צריך Multi-Horizon שונה או Features חדשים. אחרי אימון – חזור על Walkforward כדי לאמת שיפור אמיתי ולא Noise.

### 10. טיפים
1. אל תגדיל Folds בלי הצדקה – יותר Folds = יותר זמן.
2. שמור CSV והשווה התפלגות מדדים עם גרפים (Boxplot Sharpe למשל).
3. אם Fold אחד “שורף” את הממוצע – מנתח אותו בנפרד במקום לזרוק את כל השיטה.
4. שלב עם Optimize: קודם בנה פרמטרים יציבים, אז אמת ב-Walkforward.
5. אל תשתמש ב-Walkforward כמדד יחיד – שלב עם Drift + Explainability.

### 11. חיבור לאוטומציה
אם drift מופעל וגרם לרה-אימון אוטומטי בזמן שבחנת Folds – השווה timestamp של snapshot כדי להבין הבדלי תוצאות בין ריצות. מומלץ לקבע snapshot לפני ריצת Walkforward סדרתית כדי למנוע "זוזת יעד".

### 12. סיכום קצר
Walkforward הוא מבחן לחץ של זמניות האסטרטגיה. השילוב עם Model Dashboard (Drift / Snapshots / Adaptive Threshold) ועם Optimize יוצר משולש בקרה: (איכות מודל) – (התאמת פרמטרים) – (יציבות לאורך זמן).

---
לשדרוג עתידי: גרף היסטוריית AUC מול Folds, Snapshot Pinning, ניתוח סטיית Threshold לאורך זמן.

</div>

