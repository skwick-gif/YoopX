<div dir="rtl" align="right">

## לשונית Optimize – אופטימיזציית פרמטרים / משקולות (מעודכן)

### 1. מטרה
חיפוש שיטתי (או היברידי) על מרחב פרמטרים של האסטרטגיה (ספים, משקולות, חלונות חישוב וכו') כדי למקסם פונקציית מטרה (Objective) – לדוגמה Sharpe, CAGR, או מדד מורכב. המנוע מפיק גם ניתוח רגישות / Heatmaps.

### 2. אינטגרציה עם שאר הלשוניות
| לשונית | קשר |
|--------|-----|
| Scan | פרמטרים מסוימים (משקולות Score) משפיעים ישירות על תוצאות הסריקה. לאחר שינוי – כדאי לסרוק מחדש. |
| Model Dashboard | שינוי פרמטרים שמשפיעים על Feature Engineering עשוי להצדיק אימון מחדש; Auto-Retrain על Drift יתרחש במקביל אם הופעל בקונפיג. |
| Backtest | אימות סופי של סט פרמטרים “הטוב ביותר” לפני שימוש חיי. |
| Walkforward | מבחן יציבות לפרמטרים שנבחרו. אם פרמטר אחד מנצח בדאטה היסטורית אך נכשל בחלונות מאוחרים – אולי Overfit. |
| Run Repo | שמירת ריצות אופטימיזציה להשוואה בין גרסאות. |

### 3. רכיבי UI נפוצים
1. Objective – בחירת מטריקה: Sharpe / CAGR / Custom Composite (למשל Sharpe * WinRate).  
2. Parameter Space Input – JSON / טקסט מגדיר טווחים: לדוגמה `{ "min_score": [40, 60, 80], "w_prob": [0.3,0.5,0.7], "lookback": [50,100] }`.  
3. Max Iterations / Grid Size – שליטה בכמות שילובים (Grid / Random).  
4. Patience – עצירת מוקדמת: אם אין שיפור X צעדים.  
5. Seed – לשחזור ריצת דגימה אקראית.  
6. Run / Cancel – התחלת Worker.  
7. Progress / Best So Far – תצוגת המטריקה הטובה ביותר + פרמטרים.  
8. Results Table – שורות: Param Set, Objective Value, Sharpe, CAGR, MaxDD, Trades וכו'.  
9. Heatmap / Sensitivity – ויזואליזציה לזוג פרמטרים / ניתוח השפעה שולית.  
10. Export Best / Apply to Scan – כפתור שמעדכן משקולות / ספים גלובליים.  
11. Help – מדריך זה.  

### 4. תהליך אלגוריתמי (דוגמה כללית)
1. יצירת רשימת שילובים (Grid מלא או דגימה Random / Latin / Bayesian – לפי מימוש).  
2. לכל שילוב: הרצת סימולציה / חישוב מהיר (mini backtest / scoring) → הפקת מדדים.  
3. חישוב Objective מוגדר.  
4. עדכון Best אם שיפור.  
5. עצירה אם Exhausted או Patience הושג.  
6. בניית מבנה ניתוח (למשל חשיבות פרמטר – variance reduction על objective).  

### 5. בחירת Objective – עקרונות
| Objective | יתרון | חיסרון | מתי לבחור |
|----------|-------|--------|-----------|
| Sharpe | מאחד תשואה וסיכון | רגיש לריבועי סטיות קיצוניות | אסטרטגיה יציבה בתשואות תכופות |
| CAGR | ממקד בצמיחה ארוכת טווח | מתעלם מתנודתיות ישירה | השקעות מרובות חודשים/שנים |
| Avg Trade | מאפשר שיפור מיקרו | לא מתחשב במומנטום מצטבר | אסטרטגיה מרובת עסקאות זעירות |
| Composite (Sharpe * WinRate) | איזון איכות + עקביות | יכול לעודד WinRate מלאכותי | כשהפסדים גדולים הורסים אמון |
| Penalized (Sharpe - k*MaxDD) | משקלל סיכון קיצוני | בחירת k סובייקטיבית | כאשר Drawdown מכריע |

### 6. ניתוח רגישות / Heatmap
המערכת מחשבת למשל ממוצע Objective לכל ערך פרמטר בזמן שממזגים מעל שאר הפרמטרים. Heatmap של שני פרמטרים (A,B) = מטריקה ממוצעת עבור כל (a,b) מעל יתר הפרמטרים. כך מזהים אזור “פלטו” במקום נקודת חדות, ומעדיפים פרמטרים שנותנים טווח יציב.

סימני אזהרה:  
1. Peak חד בבירור → סיכון Overfitting.  
2. שינוי קל (למשל min_score 59→60) מפיל מטריקה דרמטית → לא יציב.  
3. אזור רחב (Plateau) עם מטריקה כמעט זהה → טוב – בחר ערך אמצעי.  

### 7. פירוש טבלת תוצאות
| עמודה | הסבר |
|-------|------|
| params | המילון שנבחן (subset אם truncation). |
| objective | ערך פונקציית המטרה המחושב. |
| sharpe / cagr / maxdd | מדדי ליבה – עוזרים להבין Trade-offs. |
| trades | ספירת עסקאות (נמוך מדי = לא יציב). |
| winrate | אחוז הצלחות. |
| runtime_ms | זמן חישוב סט. |

### 8. זרימת עבודה מומלצת
1. הגדר Space קטן – בדיקת תקינות (Smoke).  
2. הרחב טווחים משמעותיים (לא צעדים צפופים מדי).  
3. הרץ אופטימיזציה; תעד Top 5.  
4. בדוק Heatmap / Sensitivity – ודא שאין חדות קיצונית.  
5. החל פרמטרים ל-Scan → הרץ Backtest מלא.  
6. אמת Walkforward.  
7. שמור ריצה (Run Repo) + פרט הערות (מה שינית).  

### 9. Troubleshooting
| בעיה | סיבה | פתרון |
|------|------|--------|
| No improvement | מרחב צר מדי / Objective רועש | הגדל טווחים / השתמש ב-Smoothing על תוצאות |
| Patience stop מוקדם מדי | ערך Patience נמוך | הגדל Patience או הקטן רעש (יותר עסקאות) |
| זמן ריצה ארוך מאוד | Grid מלא על מרחב עצום | עבור לדגימה אקראית / חתוך פרמטרים לא קריטיים |
| Best params לא נשמרו ל-Scan | לא לחצת Apply / חריגה בקוד | בדוק לוג, אשר עדכון state |
| Heatmap ריק | פחות משני פרמטרים מתמשים / אין לוגיקה | ודא שלפחות שני פרמטרים עם >1 ערך |

### 10. בסט-פרקטיס
1. העדף Plateau על Peak – עמידות ברעש עתידי.  
2. שמור Seed להפקת תוצאות חוזרות (Random Search).  
3. התחל בפרמטרים בעלי השפעה כלכלית מובהקת (למשל Min Score) ורק אחר כך כוון מיקרו-טוויקים.  
4. שקול Normalization למדדים לפני יצירת Composite למניעת דומיננטיות של אחד.  
5. השווה Best מול Second Best – אם ההפרש זניח בחר ערך אמצעי.  

### 11. Mini Glossary
| Term | הסבר |
|------|------|
| Parameter Space | קבוצת כל השילובים המותרים. |
| Objective | פונקציה שמחזירה ערך מספרי להשוואת פרמטרים. |
| Patience | מספר צעדים ללא שיפור לפני עצירה. |
| Sensitivity | מידת השפעת פרמטר על התוצאה. |
| Heatmap | טבלת צבעים של מטריקה עבור זוג פרמטרים. |
| Plateau | אזור רחב עם תוצאה דומה – מועדף ליציבות. |
| Overfitting | התאמת יתר לנתוני עבר ספציפיים. |
| Random Search | דגימת תת-קבוצה אקראית של שילובים. |
| Grid Search | מעבר ממצה על כל שילובי הטווח. |
| Composite Metric | מטריקה מורכבת (שילוב כמה מדדים). |

### 12. חיבור למודל פעיל
לאחר Apply לפרמטרים שמשנים Score או פיצ'רים – הרץ אימון מחדש רק אם הבדל מהותי. Adaptive Threshold יכול לצמצם רעש בלי אימון מיידי. שמור Snapshot לפני שינוי קיצוני כדי להשוות.

### 13. סיכום קצר
Optimize מסייע למצוא אזור פרמטרים יציב – לא רק נקודה מקסימלית. צינור מומלץ: Optimize → Backtest → Walkforward → Drift Monitor → Snapshot.

---
שדרוגים עתידיים: Bayesian Optimization, שמירת Pareto Front (Sharpe vs MaxDD), אוטומציית חקירת Neighborhood.

</div>
